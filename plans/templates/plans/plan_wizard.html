<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å‡¦é‡æ”¹å–„è¨ˆç”»æ›¸ä½œæˆã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: 20px auto; padding: 0 20px; background: #f5f5f5; }
        h1 { color: #333; }
        .progress { display: flex; justify-content: space-between; margin: 30px 0; }
        .progress .step { flex: 1; text-align: center; padding: 15px; background: #e9ecef; position: relative; }
        .progress .step.active { background: #667eea; color: white; font-weight: bold; }
        .progress .step.completed { background: #28a745; color: white; }
        .form-section { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 1em; }
        .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; min-height: 100px; }
        .checkbox-group { margin: 15px 0; }
        .checkbox-item { padding: 12px; margin: 8px 0; background: #f9f9f9; border-radius: 5px; display: flex; align-items: center; }
        .checkbox-item input[type="checkbox"] { margin-right: 10px; width: 20px; height: 20px; }
        .checkbox-item label { margin: 0; font-weight: normal; }
        .buttons { display: flex; justify-content: space-between; margin-top: 30px; }
        .btn { padding: 12px 30px; border: none; border-radius: 5px; font-size: 1em; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .help-text { color: #666; font-size: 0.9em; margin-top: 5px; }
        .summary-section { background: #f9f9f9; padding: 20px; border-radius: 5px; margin: 15px 0; }
        .summary-item { padding: 10px 0; border-bottom: 1px solid #ddd; }
        .summary-item:last-child { border-bottom: none; }
        .summary-item strong { display: inline-block; width: 200px; }
    </style>
</head>
<body>
    <h1>ğŸ“ å‡¦é‡æ”¹å–„è¨ˆç”»æ›¸ä½œæˆã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰</h1>
    
    <div class="progress">
        <div class="step {% if step == '1' %}active{% elif step|add:'0' > 1 %}completed{% endif %}">1. åŸºæœ¬æƒ…å ±</div>
        <div class="step {% if step == '2' %}active{% elif step|add:'0' > 2 %}completed{% endif %}">2. ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹è¦ä»¶</div>
        <div class="step {% if step == '3' %}active{% elif step|add:'0' > 3 %}completed{% endif %}">3. è·å ´ç’°å¢ƒç­‰è¦ä»¶</div>
        <div class="step {% if step == '4' %}active{% elif step|add:'0' > 4 %}completed{% endif %}">4. åŠ ç®—è¦‹è¾¼é¡</div>
        <div class="step {% if step == '5' %}active{% endif %}">5. ç¢ºèªãƒ»ä¿å­˜</div>
    </div>
    
    <div class="form-section">
        <form method="post">
            {% csrf_token %}
            
            {% if step == '1' %}
            <h2>åŸºæœ¬æƒ…å ±ã®å…¥åŠ›</h2>
            <div class="form-group">
                <label>äº‹æ¥­è€… *</label>
                <select name="provider_id" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    {% for provider in providers %}
                    <option value="{{ provider.id }}">{{ provider.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label>å¯¾è±¡å¹´åº¦ *</label>
                <input type="number" name="fiscal_year" value="2025" required>
            </div>
            
            <div class="form-group">
                <label>å¯¾è±¡äº‹æ¥­æ‰€ *</label>
                <div class="checkbox-group">
                    {% for facility in facilities %}
                    <div class="checkbox-item">
                        <input type="checkbox" name="facility_ids" value="{{ facility.id }}" id="facility_{{ facility.id }}">
                        <label for="facility_{{ facility.id }}">{{ facility.name }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="form-group">
                <label>ç”³è«‹ã™ã‚‹åŠ ç®—åŒºåˆ† *</label>
                <select name="target_tier" required>
                    <option value="I">å‡¦é‡æ”¹å–„åŠ ç®—I</option>
                    <option value="II">å‡¦é‡æ”¹å–„åŠ ç®—II</option>
                    <option value="III">å‡¦é‡æ”¹å–„åŠ ç®—III</option>
                    <option value="IV">å‡¦é‡æ”¹å–„åŠ ç®—IV</option>
                </select>
            </div>
            
            {% elif step == '2' %}
            <h2>ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹è¦ä»¶ã®ãƒã‚§ãƒƒã‚¯</h2>
            <p class="help-text">è©²å½“ã™ã‚‹è¦ä»¶ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„</p>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" name="career_path_1" id="cp1">
                    <label for="cp1">
                        <strong>ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹è¦ä»¶I</strong><br>
                        è·ä½ãƒ»è·è²¬ãƒ»è·å‹™å†…å®¹ç­‰ã®è¦ä»¶ã‚’å®šã‚ã¦ã„ã‚‹
                    </label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" name="career_path_2" id="cp2">
                    <label for="cp2">
                        <strong>ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹è¦ä»¶II</strong><br>
                        è³‡è³ªå‘ä¸Šã®ãŸã‚ã®è¨ˆç”»ã‚’ç­–å®šã—ã€ç ”ä¿®ã®å®Ÿæ–½ã¾ãŸã¯ç ”ä¿®ã®æ©Ÿä¼šã‚’ç¢ºä¿ã—ã¦ã„ã‚‹
                    </label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" name="career_path_3" id="cp3">
                    <label for="cp3">
                        <strong>ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹è¦ä»¶III</strong><br>
                        çµŒé¨“ãƒ»è³‡æ ¼ç­‰ã«å¿œã˜ã¦æ˜‡çµ¦ã™ã‚‹ä»•çµ„ã¿ã€ã¾ãŸã¯ä¸€å®šã®åŸºæº–ã«åŸºã¥ãå®šæœŸçš„ã«æ˜‡çµ¦ã™ã‚‹ä»•çµ„ã¿ã‚’è¨­ã‘ã¦ã„ã‚‹
                    </label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" name="career_path_4" id="cp4">
                    <label for="cp4">
                        <strong>ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹è¦ä»¶IV</strong><br>
                        æ˜‡çµ¦ä»¥å¤–ã®å‡¦é‡æ”¹å–„ï¼ˆè³ä¸ãƒ»æ‰‹å½“ç­‰ï¼‰ã‚’å®Ÿæ–½ã—ã€è¦‹ãˆã‚‹åŒ–ã—ã¦ã„ã‚‹
                    </label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" name="career_path_5" id="cp5">
                    <label for="cp5">
                        <strong>ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹è¦ä»¶V</strong><br>
                        ä»‹è­·ç¦ç¥‰å£«ã®é…ç½®ç­‰ã‚’å®Ÿæ–½ã—ã¦ã„ã‚‹
                    </label>
                </div>
            </div>
            
            {% elif step == '3' %}
            <h2>è·å ´ç’°å¢ƒç­‰è¦ä»¶ã®å–ã‚Šçµ„ã¿é¸æŠ</h2>
            <p class="help-text">å„åŒºåˆ†ã‹ã‚‰1ã¤ä»¥ä¸Šã®å–ã‚Šçµ„ã¿ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            
            <div class="checkbox-group">
                {% regroup initiatives by category as initiative_groups %}
                {% for group in initiative_groups %}
                <h3 style="margin-top: 25px; color: #667eea;">{{ group.list.0.get_category_display }}</h3>
                {% for initiative in group.list %}
                <div class="checkbox-item">
                    <input type="checkbox" name="workplace_initiatives" value="{{ initiative.id }}" id="init_{{ initiative.id }}">
                    <label for="init_{{ initiative.id }}">
                        <strong>{{ initiative.item_number }}</strong> {{ initiative.description }}
                    </label>
                </div>
                {% endfor %}
                {% endfor %}
            </div>
            
            {% elif step == '4' %}
            <h2>åŠ ç®—è¦‹è¾¼é¡ã®è¨ˆç®—</h2>
            <div class="form-group">
                <label>ç·å˜ä½æ•°ï¼ˆå¹´é–“è¦‹è¾¼ã¿ï¼‰ *</label>
                <input type="number" name="total_service_units" required>
                <p class="help-text">å‰å¹´åº¦ã®å®Ÿç¸¾ç­‰ã‚’åŸºã«ã€å¹´é–“ã®ç·å˜ä½æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            </div>
            
            <div class="help-text" style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-top: 20px;">
                <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</strong><br>
                åŠ ç®—è¦‹è¾¼é¡ = ç·å˜ä½æ•° Ã— åŠ ç®—ç‡ Ã— 10å††ï¼ˆæ¦‚ç®—ï¼‰<br>
                ä¾‹ï¼šç·å˜ä½æ•° 100,000å˜ä½ Ã— åŠ ç®—ç‡16.5% Ã— 10å†† = 165,000å††/æœˆ
            </div>
            
            {% elif step == '5' %}
            <h2>å…¥åŠ›å†…å®¹ã®ç¢ºèª</h2>
            <div class="summary-section">
                <div class="summary-item">
                    <strong>äº‹æ¥­è€…:</strong> {{ summary.provider.name }}
                </div>
                <div class="summary-item">
                    <strong>å¯¾è±¡å¹´åº¦:</strong> {{ summary.fiscal_year }}å¹´åº¦
                </div>
                <div class="summary-item">
                    <strong>ç”³è«‹ã™ã‚‹åŠ ç®—åŒºåˆ†:</strong> å‡¦é‡æ”¹å–„åŠ ç®—{{ summary.target_tier }}
                </div>
                <div class="summary-item">
                    <strong>ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹è¦ä»¶:</strong>
                    {% if summary.career_path.1 %}I{% endif %}
                    {% if summary.career_path.2 %}ãƒ»II{% endif %}
                    {% if summary.career_path.3 %}ãƒ»III{% endif %}
                    {% if summary.career_path.4 %}ãƒ»IV{% endif %}
                    {% if summary.career_path.5 %}ãƒ»V{% endif %}
                </div>
            </div>
            
            <p style="margin-top: 20px; color: #666;">
                ä¸Šè¨˜ã®å†…å®¹ã§å‡¦é‡æ”¹å–„è¨ˆç”»æ›¸ã‚’ä½œæˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã‘ã‚Œã°ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
            </p>
            {% endif %}
            
            <div class="buttons">
                {% if step != '1' %}
                <a href="?step={{ step|add:'-1' }}" class="btn btn-secondary">â† æˆ»ã‚‹</a>
                {% else %}
                <a href="/" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
                {% endif %}
                
                <button type="submit" class="btn btn-primary">
                    {% if step == '5' %}ğŸ’¾ ä¿å­˜{% else %}æ¬¡ã¸ â†’{% endif %}
                </button>
            </div>
        </form>
    </div>
</body>
</html>
